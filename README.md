# 实验二 操作系统的访问控制设计实例研究

### 实验目的

- 以iOS 或Android 系统为研究对象，进行访问控制的理解和设计

### 实验环境

- 操作系统版本：HarmonyOS 2.0.0

- 硬件设备型号: HUAWEI P40 PRO

- 是否默认设置: 是

### 实验结果

- 以 iOS 和 Android 系统为研究对象
  
  - 当系统处于锁屏状态下接收到新短信时，不解锁情况下
    
    - 系统是否允许查看短信内容？
    
    ***不允许查看短信内容***
    
    - 系统是否允许回复短信？
    
    ***不允许回复短信***
    
    - 安卓上的 App : 以 ***Google Play服务*** 为例，在接管了系统短信功能和权限之后，是否会有一些不同的功能设定？
    
    <img src="https://img1.imgtp.com/2022/09/15/O4TKh1hD.jpg" title="" alt="" data-align="center">
    
    如图所示，该App在接管了系统短信功能和权限之后，可以访问和控制通讯录，读取通话记录和新建/修改/删除通话记录
  
  - 当系统处于锁屏状态下，使用系统内置（例如 iOS 的 Siri ）或第三方的语音助手可以完成以下哪些操作？
    
    - 访问通讯录 **不可以**
    - 拨打电话 **可以**
    - 访问相册 **不可以**
    - 查看短信收件箱 **不可以**
  
  - 如果你的手机支持指纹识别解锁手机，请实验并分析指纹识别相比较于简单密码、复杂密码、图形解锁、人脸识别解锁、声纹解锁等解锁方式的安全性、便利性差异。
  
  | 密码类型   | 安全性                          | 便利性                        |
  |:------:|:----------------------------:|:--------------------------:|
  | 简单密码   | 小于指纹解锁，可被分析破解或者统计破解          | 容易记住，比较方便                  |
  | 复杂密码   | 分析破解相较于简单密码更难，但是安全性还是没有指纹高   | 输入较为麻烦，记忆也不方便              |
  | 图形密码   | 有可能被穷举分析，指纹则不存在此种攻击方式        | 解锁需要画图，相较指纹比较麻烦            |
  | 人脸识别解锁 | 人脸识别主要是特征识别，安全性在特征唯一的情况下可以保证 | 方便，只需要人脸对着摄像头即可，但是可能受光线的影响 |
  | 声纹解锁   | 声纹容易被伪造从而导致安全性较低             | 需要说话，在安静的环境不方便             |
  | 指纹识别解锁 | 指纹不容易出现重复，复制指纹不容易实现，安全性较好    | 比较方便，手指一按就解锁，但是有时候手湿会影响准确性 |

思考题：

- 以上设计实现方式属于我们课堂上讲过的哪种强制访问控制模型？Lattice/BLP？Biba？

Biba模型，可以上读下写，锁屏时只能读短信，属于**上读**；解开屏幕以后，可以回复短信，属于**下写**。

- 系统或第三方应用程序是否提供了上述功能的访问控制规则修改？如果修改默认配置，是提高了安全性还是降低了安全性？

提供了，例如上述的**Google Play服务**可以修改访问控制规则。我认为修改默认配置降低了系统安全性，这让部分应用脱离了操作系统的控制。

---

### 课后题

1.**生物特征身份认证方式有哪些？优缺点分析？应用场景举例。**

| 生物特征身份认证方式 | 优点                                                                                                                                                    | 缺点                                                                                                                      | 应用场景                                                                                                                                                                                                                                                                                      |
|:----------:|:-----------------------------------------------------------------------------------------------------------------------------------------------------:|:-----------------------------------------------------------------------------------------------------------------------:|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|
| 指纹识别       | 1.实用性强，指纹样本便于获取，易以开发识别系统；可靠性易以增加，可以通过登记更多的指纹，鉴别更多的手指来提高其准确度；<br/>2.方便性好，扫描指纹的速度很快，使用非常方便；<br/>3.应用广泛，指纹识别技术占领了大部分市场；4.指纹识别产品的性价比较好，指纹采集头更加小型化，并且价格低廉。 | 1.指纹的广泛性较差，个别人或某些群体的指纹因为指纹特征很少，成像很难，对该技术的应用有一定的影响；<br/>2.用户接受性较差，过去因为在犯罪记录中使用指纹，使用户在使用上存在一定的心理障碍。                       | 1.金融机构银行等机构进行员工身份认证、自动取款机客户的身份认证、移动支付的安全认证等；<br/>2.政府机关、企事业单位：主要用于对管理人员进行授权和身份认证、考勤、安全区域员工身份验证，数据库访问安全控制等方面；<br/>3.教育、医疗、司法机构学校通过门禁控制对学生及工作人员进行身份认证；医院等对私人信息的安全认证，使最终用户能够安全方便的查询和验证相关手续、病人和捐赠者的鉴定，防止欺诈性捐助等；公安司法机关利用指纹验证解决方案，快速有效的鉴别危险罪犯，以保障公民安全；                                          |
| 人脸识别       | 人脸识别具有主动性、非侵犯性和用户友好等优点。                                                                                                                               | 1.精确性低，目前的人脸识别方法主要集中在二维图像方面，由于受到光照、姿势、表情变化的影响，识别的准确度受到很大的限制；<br/>2.成本较高，面像识别技术的改进依赖于提取特征与比对技术的提高，采集图像的设备较为昂贵。           | 1.Face ID：目前人脸检索技术最知名的是苹果的Face ID，Face ID通过多种传感器实现3D头部建模并存储在手机中，每次登陆解锁都通过多种传感器绘制3D图像与存储的模型进行人脸比对，从而实现登录和解锁。据宣传重合率可以达到百万分之一的级别；<br/>2.活体检测：判断操作用户是否为真人，抵御照片、视频、模具等作弊攻击。目前技术上分为静态活体检测和动态活体检测，应用较多的是动态活体检测；<br/>3.人脸特征定位：对于识别出来的人脸图像区域的五官进行精准定位，得到图片中人脸五官的坐标和特征值。产品应用上最主流的是社交的常用产品图片美颜和娱乐类换脸 |
| 声音识别       | 1.声音识别是一种非接触的识别技术，用户可以很自然地接受；<br/>2.声音识别技术具有较好的方便性、经济性和准确性。                                                                                           | 1.精确度较低，声音因为变化的范围太大，很难进行精确的匹配；<br/>2.技术复杂度较高，声音的音量、速度和音质会受一定的条件，如感冒的影响，需增加系统功能以适应该变化；<br/>3.成本较高，声音采集设备，如高保真的麦克风，是很昂贵的。 | 1.电子声控；<br/>2.语音拨号；<br/> 3.语音监听；<br/> 4.语音导航；<br/>5.即时翻译。                                                                                                                                                                                                                                 |
| 签名识别       | 较好的接受性，使用签名识别是一-种公认的身份识别的技术，易以被大众接受。                                                                                                                  | 1.技术复杂度较高，随着人的性情与生活方式的改变，签名也会随着改变，需增加系统功能以适应该变化；<br/>2.价格较高，用于签名的手写板结构复杂而且价格昂贵。                                         | 借条、合同等重要文件签名防抵赖                                                                                                                                                                                                                                                                           |
| 虹膜识别       | 生物特征的采集较为方便，准确性较高。据统计，到目前为止，虹膜，识别的错误率是各种生物特征识别中最低的。                                                                                                   | 1.应用普及程序较低，虹膜识别系统已经进行了许多测试，但还没有更大规模的应用；<br/>2.成本较高，很难将图像获取设备的尺寸小型化，同时需要昂贵的摄像头。                                          | 视网膜识别技术是一种非主流的生物识别产品                                                                                                                                                                                                                                                                      |

其他生理特征的识别技术：味纹识别、手形识别、人耳识别、DNA 和红外温谱图。这里除DNA识别具有绝对的权威性和准确性外，其他识别方式适合安全要求较低的场所。

2.**“找回口令功能”和“忘记密码”在访问授权机制中的意义？请尝试设计几种安全的“找回口令功能”，详细描述找回口令的用户具体操作过程。**

- 找回口令功能和忘记密码可以防止用户在丢失身份认证口令后无法进行身份认证的情况。

- 设计“找回口令功能”
  
  - **利用用户注册账户时填写的邮箱找回密码**
  
  用户端发起找回密码申请，填写丢失口令的帐号（二次确认）与动态验证码（防止机器操作）
  
  确认用户存在后，验证用户找回账户时使用的邮箱与注册账户使用的用户是否一致；
  
  若一致则继续，若重复输入三次依然不一致则24h内不允许该账户再次进入找回密码流程向用户邮箱发送重置密码链接，用户从邮箱点开链接即可重置密码

- **利用用户注册账户时绑定的手机号找回密码**
  
  用户端发起找回密码申请，填写丢失口令的帐号（二次确认）与动态验证码（防止机器操作）
  
  确认无误后，向用户申请账户时填写的手机号发送6-8位动态验证码
  
  用户在找回密码页面填写服务端发送的动态验证码后，即可修改账户密码

- **通过注册账户时填写的密保问题找回密码**
  
  用户端发起找回密码申请，填写丢失口令的帐号（二次确认）与动态验证码（防止机器操作）
  
  确认无误后，用户回答注册账户时设置的密保问题，并发送给服务端
  
  服务端验证密保问题正确后，用户即可修改账户密码

- **通过注册账户时关联的其它账户找回密码**
  
  用户端发起找回密码申请，填写丢失口令的帐号（二次确认）与动态验证码（防止机器操作）
  
  确认无误后，用户须输入正确的关联账号的用户名和密码，并发送给服务端
  
  服务端验证无误后用户即可修改账户密码

**3.绘制用户使用用户名/口令+图片验证码方式录系统的流程图。考虑认证成功和失败两种场景，考虑授权成功和失败两种场景。**

<img src="https://img1.imgtp.com/2022/09/15/oLlZAxYc.png" title="" alt="" data-align="center">

**4.Windows XP / 7 中的访问控制策略有哪些？访问控制机制有哪些？**

Windows XP / 7 中的访问控制策略有：

- 基于角色的访问控制 role-BAC (role Based Access Control）
  
  role-BAC 就是将主体划分为不同的角色，然后对每个角色的权限进行定义。

- 自主访问控制 DAC(Discretionary Access Control)
  
  DAC 就是让客体的所有者来定义访问控制规则。

- 强制访问控制 MAC(Mandatory Access Control)
  
  MAC 是一种基于安全级别标签的访问控制策略。

访问控制机制：

- 访问令牌（Access tokens）
  
  访问令牌是描述进程或线程的安全上下文的对象。令牌中的信息包括与进程或线程关联的用户帐户的标识和特权信息。当用户登录时，系统通过将用户密码与安全数据库（如域认证中的NTDS或本地认证中的SAM文件）中存储的信息进行比较来验证用户密码。如果密码经过验证，则系统将生成访问令牌。代表该用户执行的每个进程都有此访问令牌的副本。（通常我们在输入密码登陆进入Windows界面时就是一个生成访问令牌的过程）
  
  当线程与安全对象进行交互或尝试执行需要特权的系统任务时，系统使用访问令牌来标识用户。访问令牌包含以下信息：
  
  - 用户帐户的安全标识符（SID）（关SID是什么后续章节会详细介绍）
  
  - 用户所在组的SID
  
  - 标识当前登录会话（logon session）的登录SID
  
  - 用户或用户组拥有的特权列表
  
  - 所有者SID
  
  - 主要组的SID
  
  - 用户创建安全对象而不指定安全描述符时系统使用的默认DACL
  
  - 访问令牌的来源
  
  - 令牌是主要令牌（内核分配的令牌）还是模拟令牌（模拟而来的令牌）
  
  - 受限制SID的可选列表（如UAC存在时会针对某些账户删除某些特权）
  
  - 当前的模拟级别
  
  - 其他数据

- 安全描述符（Security Descriptors,SD）
  
  安全描述符是与被访问对象关联的，它含有这个对象所有者的SID，以及一个访问控制列表（ACL，Access Control List），访问控制列表又包括了DACL（Discretionary Access Control List）和SACL（System Access Control List）以及一组控制位，用于限定安全描述符含义。
  
  安全描述符包含与安全对象关联的安全信息（安全对象是可以具有安全描述符的对象。比如文件、管道、进程、注册表等）。安全描述符由`SECURITY_DESCRIPTOR`结构及其关联的安全信息组成。安全描述符的结构体如下：
  
  ```bash
  typedef struct _SECURITY_DESCRIPTOR {
    BYTE                        Revision;
    BYTE                        Sbz1;
    SECURITY_DESCRIPTOR_CONTROL Control;
    PSID                        Owner;
    PSID                        Group;
    PACL                        Sacl;
    PACL                        Dacl;
  } SECURITY_DESCRIPTOR, *PISECURITY_DESCRIPTOR;
  ```

- 访问控制列表（ACL）
  
  <img src="https://img1.imgtp.com/2022/09/16/Bw4EWeYV.png" title="" alt="" data-align="center">
  
  DACL：自主访问控制列表(DACL)是安全描述符中最重要的，它里面包含零个或多个访问控制项（ACE，Access Control Entry），每个访问控制项的内容描述了允许或拒绝特定账户对这个对象执行特定操作。
  
  SACL：系统访问控制列表（SACL） 主要是用于系统审计的，它的内容指定了当特定账户对这个对象执行特定操作时，记录到系统日志中。
  
  访问控制列表（ACL）是访问控制条目（ACE）的列表。 ACL中的每个ACE都标识一个对象（通常称这个对象为受托者，受托者可以是一个用户、用户组或者是一个登陆会话），并指定允许、拒绝或审核该受托者的访问权限。可保护对象的安全描述符可以包含两种类型的ACL：DACL和SACL。
  
  DACL标识是否允许或拒绝访问安全对象。当进程尝试访问安全对象时，系统将检查该对象的DACL中的ACE，以确定是否授予对该对象的访问权限。

- 访问控制项（ACE）
  
  访问控制条目（ACE）是访问控制列表（ACL）中的元素。一个ACL可以包含零个或多个ACE。每个ACE控制或监视指定受托者（Trustees）对对象的访问。
  
  ACE有六种类型，所有安全对象都支持其中三种。其他三种类型是目录服务对象支持的特定于对象的ACE.
  
  所有类型的ACE都包含以下访问控制信息：
  
  - 安全标识符（SID），用于标识ACE适用于的受托者
  
  - 一个访问掩码（Access Mask），该掩码指定了具体的访问权限（Access Rights），也就是可以对该对象执行的操作（此掩码非常重要，后续很多漏洞会用到）
  
  - 一个位标记，指示ACE类型的标志。
  
  - 一组位标志，指示了安全描述符所属对象的子对象是否继承这个ACE。

- 访问权限和访问掩码
  
  访问权限是一个位标志，它对应于线程可以在可保护对象上执行的一组特定操作。例如，注册表项具有`KEY_SET_VALUE`访问权限，这对应于线程在项下设置值的能力。如果线程尝试对某个对象执行操作，但没有对该对象的必要访问权限，则系统不会执行该操作。
  
  访问掩码是一个32位的值，其位与对象支持的访问权限相对应。所有Windows安全对象均使用访问掩码格式，该格式包含用于以下类型的访问权限的位：
  
  - 通用访问权限
  
  - 标准访问权限
  
  - SACL访问权限
  
  - 目录服务（域）访问权限
  
  当线程尝试打开对象的句柄时，该线程通常会指定访问掩码以请求一组访问权限。例如，需要设置和查询注册表项的值的应用程序可以通过使用访问掩码来请求`KEY_SET_VALUE`和`KEY_QUERY_VALUE`访问权限来打开注册表项。

**5.用权限三角形模型来理解并描述下 2 种威胁模型：提权、仿冒。**

权限三角形模型三要素：用户，角色，权限。

- 提权
  
  - 垂直提权
    
    如果用户可以访问他们不被允许访问的功能，那么这就是**垂直权限提升**。例如，如果非管理用户实际上可以访问他们可以删除用户帐户的管理页面，那么这就是垂直权限提升。
  
  - 横向提权
    
    当用户能够访问属于另一个用户的资源而不是他们自己的那种类型的资源时，就会出现水平权限提升。例如，如果一个员工应该只能访问自己的就业和工资记录，但实际上也可以访问其他员工的记录，那么这就是横向提权。

- 仿冒
  
  仿冒是指用户A以用户B的身份通过了认证，之后行使了B所有的权利。仿冒是从用户到角色，获取的角色改变，所以能够行使的权限也就因角色的改变而改变了。

**6.试通过操作系统的访问控制机制来达到预防一种真实病毒的运行目的。**

可以通过修改**组策略**防止蠕虫病毒，如熊猫烧香.

- 利用自动播放功能；
- 添加注册表自启动；
- 定时关闭特定程序，如杀毒软件、防火墙；
- 删除文件；

也就是说，如果能根据先验知识限制系统服务的运行、限制文件的操作等，就能有针对性地预防某一病毒。

**7.什么是 OAuth？**

OAuth是一个关于授权（authorization）的开放网络标准，在全世界得到广泛应用，目前的版本是2.0版。

OAuth在"客户端"与"服务提供商"之间，设置了一个授权层（authorization layer）。"客户端"不能直接登录"服务提供商"，只能登录授权层，以此将用户与客户端区分开来。"客户端"登录授权层所用的令牌（token），与用户的密码不同。用户可以在登录的时候，指定授权层令牌的权限范围和有效期。

"客户端"登录授权层以后，"服务提供商"根据令牌的权限范围和有效期，向"客户端"开放用户储存的资料。

使用步骤：

```bash
（A）用户打开客户端以后，客户端要求用户给予授权。

（B）用户同意给予客户端授权。

（C）客户端使用上一步获得的授权，向认证服务器申请令牌。

（D）认证服务器对客户端进行认证以后，确认无误，同意发放令牌。

（E）客户端使用令牌，向资源服务器申请获取资源。

（F）资源服务器确认令牌无误，同意向客户端开放资源。
```

不难看出来，上面六个步骤之中，B是关键，即用户怎样才能给于客户端授权。有了这个授权以后，客户端就可以获取令牌，进而凭令牌获取资源。

**8.什么是OpenID?**

OpenID是一个去中心化的网上身份认证系统。对于支持OpenID的网站，用户不需要记住像用户名和密码这样的传统验证标记。取而代之的是，他们只需要预先在一个作为OpenID身份提供者（identity provider, IdP）的网站上注册。OpenID是去中心化的，任何网站都可以使用OpenID来作为用户登录的一种方式，任何网站也都可以作为OpenID身份提供者。OpenID既解决了问题而又不需要依赖于中心性的网站来确认数字身份。

**9.试用本章所学理论分析 OAuth 和 OpenID 的区别与联系**

OpenID是Authentication

OAuth是Authorization

- 区别
  
  前者是网站对用户进行认证，让网站知道“你是你所声称的URL的属主”
  
  后者其实并不包括认证，只不过“只有认证成功的人才能进行授权”，结果类似于“认证+授权”了。OAuth相当于：A网站给B网站一个令牌，然后告诉B网站说根据这个令牌你可以获取到某用户在A网站上允许你访问的所有信息
  
  如果A网站需要用B网站的用户系统进行登录，它可以
  
  - 选择OpenID认证，然后通过attribute exchange获取用户的昵称或其他通过OpenID暴露出来的用户属性，或者
  
  - 选择OAuth认证，获取到token后再用token获取用户昵称或其他允许被访问的信息

- 联系
  
  两者都可以用来实现用户验证和用户授权，因为，两者本质上都是用来获取断言的方法（assertion verification method），都可以通过url重定向返回断言， 而用户身份和用户权限本质上都是断言，用户身份是关于“用户是谁”，用户权限是关于“用户可以操作什么”
  
  OAuth2是OpenID-Connect的基础（在OpenID-Connect中，ID-Token也被当做是一种资源）

**10.如何使用 OAuth 和 OpenID 相关技术实现单点登录（Single Sign On）？**

单点登录是在多个应用系统中，用户只需登录一次就可以访问所有相互信任的应用系统的保护资源，若用户在某个应用系统中进行注销登录，所有应用系统都不能再直接访问保护资源

<img src="https://img1.imgtp.com/2022/09/17/KvDcAcZ7.png" title="" alt="" data-align="center">

由上图可知： 
1.当用户第一次登录时，将用户名 密码发送给用户服务 
2.验证用户将用户标识OpenId返回到客户端 
3.客户端进行存储 
4.访问子系统 将OpenId发送到子系统 
5子系统将OpenId转发到验证服务 
6.验证服务将用户认证信息返回给子系统 
7.子系统构建用户验证信息后将授权后的内容返回给客户端

### 参考资料

[biometric technology](https://wiki.mbalib.com/wiki/%E7%94%9F%E7%89%A9%E8%AF%86%E5%88%AB%E6%8A%80%E6%9C%AF#.E7.94.9F.E7.89.A9.E8.AF.86.E5.88.AB.E6.8A.80.E6.9C.AF.E7.9A.84.E5.BA.94.E7.94.A8.07UNIQ1ff4b1e4423ab1f9-nowiki-0000000B-QINU2.07UNIQ1ff4b1e4423ab1f9-nowiki-0000000C-QINU)

[password reset](https://www.troyhunt.com/everything-you-ever-wanted-to-know/)

[windows访问控制-GitBook](https://rootclay.gitbook.io/windows-access-control/)

[访问控制漏洞和权限提升](https://blog.csdn.net/ZripenYe/article/details/120793746)

[OAuth2.0](https://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html)

[OpenID 和 OAuth 的区别-阿里云开发者社区](https://developer.aliyun.com/article/53559)
